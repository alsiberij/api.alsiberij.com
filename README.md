# Открытый API интернет магазина фотографий [alsiberij.com](https://alsiberij.com)
___
## Описание

Проект был разработан с целью изучения REST архитектуры.

### Структура ответа сервера

Сервер всегда отвечает в формате JSON.
В случае успеха это будет `{"response": ... }`, а в случае ошибки - 
`{"error": "Description"}`

### Аутентификация

Аутентификация происходит по:
- Идентификатору существующей сессии - параметр **session**
- Токену доступа - параметр **accessToken**

Один из параметров должен быть передан в POST или GET запросе. Например: _/users/get?userIDS=[1]**&accessToken=12345**_
или _/users/getAll?**session=12345**_

### Доступные объекты и методы

- Сущность `users`
    - Метод `get`: Получить информацию о пользователях с идентификаторами `userIDs`.
        - Параметры: `userIDs` - массив идентификаторов пользователей в формате JSON
        - Формат ответа: `{"response": [ {"ID": 1, ...} ]}`
    - Метод `getAll`: Получить информацию о всех пользователях
        - Параметры: НЕТ
        - Формат ответа: `{"response": [{"ID": 1, ...}, {"ID": 2, ...}, ...]}`

### Процесс обработки запроса

1. В файле `.htacess` настроена перезапись URL таким образом, что все запросы обрабатываются
   `index.php`.
2. Удаляются существующие сессионные cookie-файлы.
3. Запускается новая сессия, если в параметрах POST или GET запроса был передан ее идентификатор.
4. Из строки запроса выделяются имена сущности и метода. Если данные не корректны, сервер ответит ошибкой
`400`
5. Происходит обращение к фабрике сущностей, которая вернет либо объект сущности, либо null.
Во втором случае сервер ответит ошибкой `400`.
6. На объекте сущности вызывается метод `respond($string methodName): void`, в который передается
имя метода.

### Описание классов

Каждая сущность представляется двумя классами: непосредственно сама сущность и ее API.
Первый класс содержит всю информацию о сущности, т.е. её поля, а также методы для получения изменения
этих полей. Второй же содержит API методы, которые применимы к данной сущности. Рассмотрим подробнее API класс. Базовый
класс для всех сущностей - `API`. В нем содержатся три поля: объект авторизованного пользователя (может быть null),
объект соединения с базой данных и абстрактную фабрику сущностей, а также абстрактный метод `respond()`. Любой класс,
который наследуется от `API` должен реализовать метод `respond()` и проинициализировать поле фабрики. Таким образом,
любой API класс будет иметь возможность конструировать объекты соответствующих сущностей, вызывать свои методы внутри
переопределенного `respond()` и, благодаря объекту авторизованного пользователя, соблюдать права доступа.

...

Документ будет дополняться по мере разработки.